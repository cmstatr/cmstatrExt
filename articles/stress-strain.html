<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="cmstatrExt">
<title>Stress-Strain Curves • cmstatrExt</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Stress-Strain Curves">
<meta property="og:description" content="cmstatrExt">
<meta property="og:image" content="https://cmstatrExt.cmstatr.net/reference/figures/logo-240x278.png">
<meta property="og:image:alt" content="More statistical methods for composite material data: cmstatrExt">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-dark navbar-expand-lg bg-primary"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">cmstatrExt</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.3.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/equivalency-p-values.html">p-Values for Equivalency</a>
    <div class="dropdown-divider"></div>
    <h6 class="dropdown-header" data-toc-skip>Calculators</h6>
    <a class="dropdown-item" href="../articles/compute-equiv-factors.html">Equivalency Factor Calculator</a>
    <a class="dropdown-item" href="../articles/compute-p-value-equiv.html">Equivalency p-Value Calculator</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/cmstatr/cmstatrExt/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.svg" class="logo" alt=""><h1>Stress-Strain Curves</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/cmstatr/cmstatrExt/blob/HEAD/vignettes/stress-strain.Rmd" class="external-link"><code>vignettes/stress-strain.Rmd</code></a></small>
      <div class="d-none name"><code>stress-strain.Rmd</code></div>
    </div>

    
    
<p>This vignette demonstrates generation of averaged stress-strain
curves from data from several coupons. The same procedure can be used to
generate bearing load-deformation curves and other similar curves.</p>
<p>There are two functions provided by the <code>cmstatrExt</code>
package for doing this. The function <code><a href="../reference/average_curve_lm.html">average_curve_lm()</a></code>
uses <code><a href="https://rdrr.io/r/stats/lm.html" class="external-link">stats::lm()</a></code> behind the scenes to fit a curve defined
by a <code>formula</code> to the data. The function
<code><a href="../reference/average_curve_optim.html">average_curve_optim()</a></code> uses numeric optimization to fit a
curve defined by a user-specified function to the data. Use the former
function for fitting polynomials, use the latter for fitting exponential
models or models with discontinuities. Both will be discussed in more
detail in this vignette.</p>
<div class="section level2">
<h2 id="setup">Setup<a class="anchor" aria-label="anchor" href="#setup"></a>
</h2>
<p>In this example, the following packages need to be loaded:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">knitr</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/pkg/knitr/man/opts_chunk.html" class="external-link">opts_chunk</a></span><span class="op">$</span><span class="fu">set</span><span class="op">(</span>message <span class="op">=</span> <span class="cn">FALSE</span>, warning <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/cmstatr/cmstatrExt" class="external-link">cmstatrExt</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org" class="external-link">tidyverse</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; ── <span style="font-weight: bold;">Attaching core tidyverse packages</span> ──────────────────────── tidyverse 2.0.0 ──</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> <span style="color: #0000BB;">dplyr    </span> 1.1.3     <span style="color: #00BB00;">✔</span> <span style="color: #0000BB;">readr    </span> 2.1.4</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> <span style="color: #0000BB;">forcats  </span> 1.0.0     <span style="color: #00BB00;">✔</span> <span style="color: #0000BB;">stringr  </span> 1.5.0</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> <span style="color: #0000BB;">ggplot2  </span> 3.4.4     <span style="color: #00BB00;">✔</span> <span style="color: #0000BB;">tibble   </span> 3.2.1</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> <span style="color: #0000BB;">lubridate</span> 1.9.3     <span style="color: #00BB00;">✔</span> <span style="color: #0000BB;">tidyr    </span> 1.3.0</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> <span style="color: #0000BB;">purrr    </span> 1.0.2     </span></span>
<span><span class="co">#&gt; ── <span style="font-weight: bold;">Conflicts</span> ────────────────────────────────────────── tidyverse_conflicts() ──</span></span>
<span><span class="co">#&gt; <span style="color: #BB0000;">✖</span> <span style="color: #0000BB;">dplyr</span>::<span style="color: #00BB00;">filter()</span> masks <span style="color: #0000BB;">stats</span>::filter()</span></span>
<span><span class="co">#&gt; <span style="color: #BB0000;">✖</span> <span style="color: #0000BB;">dplyr</span>::<span style="color: #00BB00;">lag()</span>    masks <span style="color: #0000BB;">stats</span>::lag()</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Use the conflicted package (<span style="color: #0000BB; font-style: italic;">&lt;http://conflicted.r-lib.org/&gt;</span>) to force all conflicts to become errors</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="example-data">Example Data<a class="anchor" aria-label="anchor" href="#example-data"></a>
</h2>
<p>The <code>cmstatrExt</code> package comes with some example
stress-strain data. The first few rows of this data are:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">pa12_tension</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 3</span></span></span>
<span><span class="co">#&gt;   Coupon     Strain Stress</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> Coupon 4 0        0.056<span style="text-decoration: underline;">1</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> Coupon 4 0.000<span style="text-decoration: underline;">200</span> 0.247 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> Coupon 4 0.000<span style="text-decoration: underline;">400</span> 0.569 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> Coupon 4 0.000<span style="text-decoration: underline;">601</span> 0.440 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> Coupon 4 0.000<span style="text-decoration: underline;">801</span> 0.778 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span> Coupon 4 0.001<span style="text-decoration: underline;">00</span>  0.854</span></span></code></pre></div>
<p>This data is in “tidy” format. This means that each data-point
(stress-strain value) is in a row of the <code>data.frame</code>. This
example data set contains stress-strain data from four coupons (Samples
1 through 4). Each row identifies the coupon that the observation comes
from. While the order of the columns does not matter and you can give
each column any name you wish, the data will need to be in this type of
format.</p>
<p>Let’s plot the <code>pa12_tension</code> example data.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pa12_tension</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Strain</span>, y <span class="op">=</span> <span class="va">Stress</span>, color <span class="op">=</span> <span class="va">Coupon</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="stress-strain_files/figure-html/unnamed-chunk-3-1.png" width="480"></p>
</div>
<div class="section level2">
<h2 id="fitting-a-polynomial-model">Fitting a Polynomial Model<a class="anchor" aria-label="anchor" href="#fitting-a-polynomial-model"></a>
</h2>
<p>For the first example, we’ll fit the following quadratic model:</p>
<p><span class="math display">\[
\sigma = c_1 \epsilon + c_2 \epsilon^2
\]</span> where <span class="math inline">\(\sigma\)</span> is the
stress, <span class="math inline">\(\epsilon\)</span> is the strain and
<span class="math inline">\(c_1\)</span> and <span class="math inline">\(c_2\)</span> are constants that we’ll find. We
need to write this as an <code>R</code> <code>formula</code>, which has
slightly different notation. The stress and strain variables in our data
are <code>Stress</code> and <code>Strain</code>, respectively, so we’ll
use those variable names in the formula.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">Stress</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/AsIs.html" class="external-link">I</a></span><span class="op">(</span><span class="va">Strain</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/AsIs.html" class="external-link">I</a></span><span class="op">(</span><span class="va">Strain</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span> <span class="op">+</span> <span class="fl">0</span></span></code></pre></div>
<p>Notice that in this formula, a tilde (<code>~</code>) is used instead
of an equal sign. You’ll also notice that we’ve wrapped the terms on the
right-hand side inside the identity function <code><a href="https://rdrr.io/r/base/AsIs.html" class="external-link">I()</a></code>: the
reason for this is that <code>lm</code> will treat <code>Strain^2</code>
as an interaction, rather than squaring the value of
<code>Strain</code>, while <code>I(Strain^2)</code> will actually square
the value of <code>Strain</code>. The formula doesn’t need coefficients
(e.g. <span class="math inline">\(c_1\)</span> and <span class="math inline">\(c_2\)</span>). Finally, notice that we’ve included
the term <code>+0</code>, which tells <code>lm</code> that we want the
intercept to be zero, which will normally be desirable due to the
physical notion that stress ought to be zero at zero strain.</p>
<p>The function <code>average_curve_lm</code> takes four arguments. The
first is a <code>data.frame</code> with the data. The second is the name
of the variable defining the coupon. The third is the formula that we
just discussed. The last argument is the number of “bins”: this has a
default of 100 and hence can be omitted. See the documentation for this
function for information about binning the data.</p>
<p>Let’s run this function and then execute the <code>summary</code>
method on the result:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">curve_quadratic</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/average_curve_lm.html">average_curve_lm</a></span><span class="op">(</span></span>
<span>  <span class="va">pa12_tension</span>, <span class="va">Coupon</span>,</span>
<span>  <span class="va">Stress</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/AsIs.html" class="external-link">I</a></span><span class="op">(</span><span class="va">Strain</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/AsIs.html" class="external-link">I</a></span><span class="op">(</span><span class="va">Strain</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span> <span class="op">+</span> <span class="fl">0</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">curve_quadratic</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Range: ` Strain ` in  [0,  0.1409409 ]</span></span>
<span><span class="co">#&gt; n_bins =  100</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Call:</span></span>
<span><span class="co">#&gt; average_curve_lm(data = pa12_tension, coupon_var = Coupon, model = Stress ~ </span></span>
<span><span class="co">#&gt;     I(Strain) + I(Strain^2) + 0)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Residuals:</span></span>
<span><span class="co">#&gt;     Min      1Q  Median      3Q     Max </span></span>
<span><span class="co">#&gt; -2.3812 -1.1354  0.0107  1.4057  4.2013 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Coefficients:</span></span>
<span><span class="co">#&gt;              Estimate Std. Error t value Pr(&gt;|t|)    </span></span>
<span><span class="co">#&gt; I(Strain)    1010.585      4.016   251.6   &lt;2e-16 ***</span></span>
<span><span class="co">#&gt; I(Strain^2) -4913.506     36.786  -133.6   &lt;2e-16 ***</span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Residual standard error: 1.626 on 398 degrees of freedom</span></span>
<span><span class="co">#&gt; Multiple R-squared:  0.9985, Adjusted R-squared:  0.9984 </span></span>
<span><span class="co">#&gt; F-statistic: 1.286e+05 on 2 and 398 DF,  p-value: &lt; 2.2e-16</span></span></code></pre></div>
<p>The <code>summary</code> method shows the strain range over which the
curve was fit. This range always starts at zero and ends at the
<em>lowest</em> maximum strain of any individual coupon. The
<code>summary</code> method also lists the coefficients as well as
information about whether each term is statistically significant, the
residuals and R-squared values.</p>
<p>Next, let’s plot the original data and the curve fit. We’ll use the
<code>augment</code> method to add the curve fit to the original data,
then pass the result to <code>ggplot</code>.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">curve_quadratic</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://generics.r-lib.org/reference/augment.html" class="external-link">augment</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Strain</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">Stress</span>, color <span class="op">=</span> <span class="va">Coupon</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">.fit</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="stress-strain_files/figure-html/unnamed-chunk-5-1.png" width="480"></p>
<p>Due to the polynomial model that we chose (quadratic), this curve fit
is poor. We can do better. Let’s try a cubic function next.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">curve_cubic</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/average_curve_lm.html">average_curve_lm</a></span><span class="op">(</span></span>
<span>  <span class="va">pa12_tension</span>, <span class="va">Coupon</span>,</span>
<span>  <span class="va">Stress</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/AsIs.html" class="external-link">I</a></span><span class="op">(</span><span class="va">Strain</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/AsIs.html" class="external-link">I</a></span><span class="op">(</span><span class="va">Strain</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/AsIs.html" class="external-link">I</a></span><span class="op">(</span><span class="va">Strain</span><span class="op">^</span><span class="fl">3</span><span class="op">)</span> <span class="op">+</span> <span class="fl">0</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">curve_cubic</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Range: ` Strain ` in  [0,  0.1409409 ]</span></span>
<span><span class="co">#&gt; n_bins =  100</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Call:</span></span>
<span><span class="co">#&gt; average_curve_lm(data = pa12_tension, coupon_var = Coupon, model = Stress ~ </span></span>
<span><span class="co">#&gt;     I(Strain) + I(Strain^2) + I(Strain^3) + 0)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Residuals:</span></span>
<span><span class="co">#&gt;     Min      1Q  Median      3Q     Max </span></span>
<span><span class="co">#&gt; -2.3080 -0.4003 -0.1726  0.3103  2.2058 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Coefficients:</span></span>
<span><span class="co">#&gt;              Estimate Std. Error t value Pr(&gt;|t|)    </span></span>
<span><span class="co">#&gt; I(Strain)    1173.285      4.662  251.69   &lt;2e-16 ***</span></span>
<span><span class="co">#&gt; I(Strain^2) -8761.916    102.493  -85.49   &lt;2e-16 ***</span></span>
<span><span class="co">#&gt; I(Strain^3) 20480.874    537.832   38.08   &lt;2e-16 ***</span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Residual standard error: 0.7546 on 397 degrees of freedom</span></span>
<span><span class="co">#&gt; Multiple R-squared:  0.9997, Adjusted R-squared:  0.9997 </span></span>
<span><span class="co">#&gt; F-statistic: 3.985e+05 on 3 and 397 DF,  p-value: &lt; 2.2e-16</span></span></code></pre></div>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">curve_cubic</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://generics.r-lib.org/reference/augment.html" class="external-link">augment</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Strain</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">Stress</span>, color <span class="op">=</span> <span class="va">Coupon</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">.fit</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="stress-strain_files/figure-html/unnamed-chunk-7-1.png" width="480"></p>
<p>This cubic model is a much better fit. The equation for this curve
fit is:</p>
<p><span class="math display">\[
\sigma = 1174 \, \epsilon - 8783 \, \epsilon^2 + 20586 \, \epsilon^3
\]</span></p>
<p>Strain does not need to be the independent variable and stress does
not need to be the dependent variable. We could fit a model with these
reversed.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/average_curve_lm.html">average_curve_lm</a></span><span class="op">(</span></span>
<span>  <span class="va">pa12_tension</span>, <span class="va">Coupon</span>,</span>
<span>  <span class="va">Strain</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/AsIs.html" class="external-link">I</a></span><span class="op">(</span><span class="va">Stress</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/AsIs.html" class="external-link">I</a></span><span class="op">(</span><span class="va">Stress</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/AsIs.html" class="external-link">I</a></span><span class="op">(</span><span class="va">Stress</span><span class="op">^</span><span class="fl">3</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/AsIs.html" class="external-link">I</a></span><span class="op">(</span><span class="va">Stress</span><span class="op">^</span><span class="fl">4</span><span class="op">)</span> <span class="op">+</span> <span class="fl">0</span></span>
<span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://generics.r-lib.org/reference/augment.html" class="external-link">augment</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">Stress</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Strain</span>, color <span class="op">=</span> <span class="va">Coupon</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">.fit</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="stress-strain_files/figure-html/unnamed-chunk-8-1.png" width="480"></p>
<p>In this case, the fit is not very good, so it’s not of much practical
use. However, note that the curve fit ends at the lowest maximum
<em>stress</em> value of any individual coupon this time. The curve fit
will always end at the lowest maximum value of the independent variable
(the variable on the right hand side of the formula).</p>
</div>
<div class="section level2">
<h2 id="fitting-a-bilinear-model">Fitting a Bilinear Model<a class="anchor" aria-label="anchor" href="#fitting-a-bilinear-model"></a>
</h2>
<p>Next, we turn our attention to fitting a model that cannot be
represented by an <code>R</code> <code>formula</code>. We’ll fit the
following model:</p>
<p><span class="math display">\[
\sigma = \left\{
\begin{matrix}
c_1 \epsilon &amp; \text{if }\epsilon \le \epsilon_1 \\
c_2 \left(\epsilon - \epsilon_1\right) + c_1\epsilon_1 &amp;
\text{otherwise}
\end{matrix}
\right.
\]</span></p>
<p>This model will thus be a straight line starting from the origin
extending to an unknown value of strain (<span class="math inline">\(\epsilon_1\)</span>), then continuing with a
different slope. In order to use this model with
<code>average_curve_optim</code>, we need to write this as an
<code>R</code> function where the first argument is the independent
variable (strain in our case) and the second argument is a vector of
parameters. In this case, there are three parameters, <span class="math inline">\(c_1\)</span>, <span class="math inline">\(c_2\)</span> and <span class="math inline">\(\epsilon_1\)</span>.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">bilinear_fn</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">strain</span>, <span class="va">par</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">c1</span> <span class="op">&lt;-</span> <span class="va">par</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span></span>
<span>  <span class="va">c2</span> <span class="op">&lt;-</span> <span class="va">par</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span></span>
<span>  <span class="va">e1</span> <span class="op">&lt;-</span> <span class="va">par</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="va">strain</span> <span class="op">&lt;=</span> <span class="va">e1</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">c1</span> <span class="op">*</span> <span class="va">strain</span><span class="op">)</span></span>
<span>  <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">c2</span> <span class="op">*</span> <span class="op">(</span><span class="va">strain</span> <span class="op">-</span> <span class="va">e1</span><span class="op">)</span> <span class="op">+</span> <span class="va">c1</span> <span class="op">*</span> <span class="va">e1</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>The function <code>average_curve_optim</code> takes nine
arguments:</p>
<ul>
<li>
<code>data</code> a <code>data.frame</code> with the stress-strain
data</li>
<li>
<code>coupon_var</code> the name of the column representing the
coupon</li>
<li>
<code>x_var</code> the name of the column representing the
independent variable</li>
<li>
<code>y_var</code> the name of column representing the dependent
variable</li>
<li>
<code>fn</code> the function representing the model</li>
<li>
<code>par</code> an initial guess at the parameters of the
model</li>
<li>
<code>n_bins</code> the number of bins to sort the data into. The
default is 100 and it does not need to be specified to accept the
default.</li>
<li>
<code>method</code> the method used by <code><a href="https://rdrr.io/r/stats/optim.html" class="external-link">optim()</a></code>.
Defaults to “L-BFGS-B”</li>
<li>
<code>...</code> extra parameters to pass to
<code><a href="https://rdrr.io/r/stats/optim.html" class="external-link">optim()</a></code>
</li>
</ul>
<p>We’ll call this function:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">curve_bilinear</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/average_curve_optim.html">average_curve_optim</a></span><span class="op">(</span></span>
<span>  <span class="va">pa12_tension</span>,</span>
<span>  <span class="va">Coupon</span>, <span class="va">Strain</span>, <span class="va">Stress</span>,</span>
<span>  <span class="va">bilinear_fn</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">0.04</span><span class="op">)</span> <span class="co"># the initial guess</span></span>
<span><span class="op">)</span></span>
<span><span class="va">curve_bilinear</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Range: ` Strain ` in  [ 0,  0.1409409 ]</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Call:</span></span>
<span><span class="co">#&gt; average_curve_optim(data = pa12_tension, coupon_var = Coupon, </span></span>
<span><span class="co">#&gt;     x_var = Strain, y_var = Stress, fn = bilinear_fn, par = c(1, </span></span>
<span><span class="co">#&gt;         1, 0.04))</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Parameters:</span></span>
<span><span class="co">#&gt; [1] 265.6498522 316.1356934  -0.3258095</span></span></code></pre></div>
<p>The value of the third parameter, <span class="math inline">\(\epsilon_1\)</span> is well outside the range we’d
expect. We’d expect that the “knee” to be somewhere in the range of
0.025-0.100. We can specify upper and lower bounds on the parameters as
follows:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">curve_bilinear</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/average_curve_optim.html">average_curve_optim</a></span><span class="op">(</span></span>
<span>  <span class="va">pa12_tension</span>,</span>
<span>  <span class="va">Coupon</span>, <span class="va">Strain</span>, <span class="va">Stress</span>,</span>
<span>  <span class="va">bilinear_fn</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">0.04</span><span class="op">)</span>,</span>
<span>  lower <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0.025</span><span class="op">)</span>,</span>
<span>  upper <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2000</span>, <span class="fl">2000</span>, <span class="fl">0.100</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="va">curve_bilinear</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Range: ` Strain ` in  [ 0,  0.1409409 ]</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Call:</span></span>
<span><span class="co">#&gt; average_curve_optim(data = pa12_tension, coupon_var = Coupon, </span></span>
<span><span class="co">#&gt;     x_var = Strain, y_var = Stress, fn = bilinear_fn, par = c(1, </span></span>
<span><span class="co">#&gt;         1, 0.04), lower = c(0, 0, 0.025), upper = c(2000, 2000, </span></span>
<span><span class="co">#&gt;         0.1))</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Parameters:</span></span>
<span><span class="co">#&gt; [1] 873.46774319  79.60813130   0.05093549</span></span></code></pre></div>
<p>We can now plot the curve fit over laid with the original data.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">curve_bilinear</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://generics.r-lib.org/reference/augment.html" class="external-link">augment</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Strain</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">Stress</span>, color <span class="op">=</span> <span class="va">Coupon</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">.fit</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="stress-strain_files/figure-html/unnamed-chunk-12-1.png" width="480"></p>
</div>
<div class="section level2">
<h2 id="preprocessing-data">Preprocessing Data<a class="anchor" aria-label="anchor" href="#preprocessing-data"></a>
</h2>
<p>The example data in the <code>pa12_tension</code> data set is fairly
well behaved and does not need pre-processing. However, most data that
you will actually deal with will require pre-processing.</p>
<p>The <code>fff_shear</code> data set that comes with the
<code>cmstatrExt</code> package is more typical data that does require
pre-processing. Let’s start by plotting this data.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fff_shear</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Strain</span>, y <span class="op">=</span> <span class="va">Stress</span>, color <span class="op">=</span> <span class="va">Specimen</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="stress-strain_files/figure-html/unnamed-chunk-13-1.png" width="480"></p>
<p>There are three aspects of this data that we’ll deal with:</p>
<ul>
<li>The post-failure behavior at high strains will be removed. This part
of the stress-strain curve is not important to most structural analysis
and will make cure-fitting difficult.</li>
<li>We’ll remove the “toe” at the start of the curves. (The “toe” is the
small portion of the curves at low strain that have a relatively low
slope). Depending on the test method, this “toe” can be caused by
behavior like the test coupon seating itself in the test fixture, or
clearance being taken up. Depending on the cause of the “toe,” it may be
desirable to remove it. In this case, removing it is desirable.</li>
<li>The curves, even with the “toe” removed, do no pass through the
origin. This is due to an offset in the strain measurement that does not
correspond to the physical behavior of the material, so we’ll apply an
appropriate offset.</li>
</ul>
<p>None of these adjustments are done using the functionality of
<code>cmstatrExt</code>, but this example is included anyways as these
types of adjustments are typically a pre-requisite of curve fitting
using <code>cmstatrExt</code>.</p>
<p>We’ll start by removing the offset from the data. To do this, we’ll
fit a straight line to the data from each coupon over a stress range of
1000 to 3000 <code>psi</code>, find the x-intercept of this line and
subtract this x-intercept from the strain value. This is a bit
complicated, so we’ll do it in a few steps before combining everything.
We’ll start by filtering the data so that the stress values are in the
range 1000 to 3000, grouping by <code>Specimen</code> and finding the
x-intercept for each. This code will use the <code><a href="https://tidyr.tidyverse.org/reference/nest.html" class="external-link">nest()</a></code>,
<code><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate()</a></code> <code><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map()</a></code> pattern.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fff_shear</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">Stress</span> <span class="op">&gt;</span> <span class="fl">1000</span> <span class="op">&amp;</span> <span class="va">Stress</span> <span class="op">&lt;</span> <span class="fl">3000</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">Specimen</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/nest.html" class="external-link">nest</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>lm <span class="op">=</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map</a></span><span class="op">(</span><span class="va">data</span>, <span class="op">~</span><span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">Strain</span> <span class="op">~</span> <span class="va">Stress</span>, data <span class="op">=</span> <span class="va">.</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>x_intercept <span class="op">=</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map</a></span><span class="op">(</span><span class="va">lm</span>, <span class="op">~</span><span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">.x</span>, <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>Stress <span class="op">=</span> <span class="fl">0</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">lm</span>, <span class="va">data</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/unnest.html" class="external-link">unnest</a></span><span class="op">(</span><span class="va">x_intercept</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 3 × 2</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># Groups:   Specimen [3]</span></span></span>
<span><span class="co">#&gt;   Specimen x_intercept</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> A          -<span style="color: #BB0000;">0.000</span><span style="color: #BB0000; text-decoration: underline;">163</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> B          -<span style="color: #BB0000;">0.000</span><span style="color: #BB0000; text-decoration: underline;">117</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> C          -<span style="color: #BB0000;">0.000</span><span style="color: #BB0000; text-decoration: underline;">432</span></span></span></code></pre></div>
<p>Now we’ll use <code><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">inner_join()</a></code> to join the
<code>x_intercept</code> column to the original data (matching the
appropriate <code>Specimen</code>). We’ll use <code><a href="https://rdrr.io/r/utils/head.html" class="external-link">head()</a></code> to
just show the first 6 rows for brevity.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fff_shear</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">Stress</span> <span class="op">&gt;</span> <span class="fl">1000</span> <span class="op">&amp;</span> <span class="va">Stress</span> <span class="op">&lt;</span> <span class="fl">3000</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">Specimen</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/nest.html" class="external-link">nest</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>lm <span class="op">=</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map</a></span><span class="op">(</span><span class="va">data</span>, <span class="op">~</span><span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">Strain</span> <span class="op">~</span> <span class="va">Stress</span>, data <span class="op">=</span> <span class="va">.</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>x_intercept <span class="op">=</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map</a></span><span class="op">(</span><span class="va">lm</span>, <span class="op">~</span><span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">.x</span>, <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>Stress <span class="op">=</span> <span class="fl">0</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">lm</span>, <span class="va">data</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/unnest.html" class="external-link">unnest</a></span><span class="op">(</span><span class="va">x_intercept</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">inner_join</a></span><span class="op">(</span><span class="va">fff_shear</span>, by <span class="op">=</span> <span class="st">"Specimen"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fl">6</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 4</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># Groups:   Specimen [1]</span></span></span>
<span><span class="co">#&gt;   Specimen x_intercept Stress   Strain</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> A          -<span style="color: #BB0000;">0.000</span><span style="color: #BB0000; text-decoration: underline;">163</span>   230. 0       </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> A          -<span style="color: #BB0000;">0.000</span><span style="color: #BB0000; text-decoration: underline;">163</span>   241. 0.000<span style="text-decoration: underline;">273</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> A          -<span style="color: #BB0000;">0.000</span><span style="color: #BB0000; text-decoration: underline;">163</span>   240. 0.000<span style="text-decoration: underline;">426</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> A          -<span style="color: #BB0000;">0.000</span><span style="color: #BB0000; text-decoration: underline;">163</span>   245. 0.000<span style="text-decoration: underline;">536</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> A          -<span style="color: #BB0000;">0.000</span><span style="color: #BB0000; text-decoration: underline;">163</span>   246. 0.000<span style="text-decoration: underline;">597</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span> A          -<span style="color: #BB0000;">0.000</span><span style="color: #BB0000; text-decoration: underline;">163</span>   264. 0.000<span style="text-decoration: underline;">834</span></span></span></code></pre></div>
<p>Finally, we’ll subtract the x-intercept from the strain for each
coupon to obtain the corrected data (and delete the unneeded
<code>x_intercept</code> column).</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fff_shear_offset</span> <span class="op">&lt;-</span> <span class="va">fff_shear</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">Stress</span> <span class="op">&gt;</span> <span class="fl">1000</span> <span class="op">&amp;</span> <span class="va">Stress</span> <span class="op">&lt;</span> <span class="fl">3000</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">Specimen</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/nest.html" class="external-link">nest</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>lm <span class="op">=</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map</a></span><span class="op">(</span><span class="va">data</span>, <span class="op">~</span><span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">Strain</span> <span class="op">~</span> <span class="va">Stress</span>, data <span class="op">=</span> <span class="va">.</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>x_intercept <span class="op">=</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map</a></span><span class="op">(</span><span class="va">lm</span>, <span class="op">~</span><span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">.x</span>, <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>Stress <span class="op">=</span> <span class="fl">0</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">lm</span>, <span class="va">data</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/unnest.html" class="external-link">unnest</a></span><span class="op">(</span><span class="va">x_intercept</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">inner_join</a></span><span class="op">(</span><span class="va">fff_shear</span>, by <span class="op">=</span> <span class="st">"Specimen"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>Strain <span class="op">=</span> <span class="va">Strain</span> <span class="op">-</span> <span class="va">x_intercept</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">x_intercept</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>We’ll plot this now.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fff_shear_offset</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Strain</span>, y <span class="op">=</span> <span class="va">Stress</span>, color <span class="op">=</span> <span class="va">Specimen</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="stress-strain_files/figure-html/unnamed-chunk-17-1.png" width="480"></p>
<p>There are many approaches to removing the post-failure behavior. The
specific approach that should be used will depend on the data and test
method. In some cases, you might choose to simply manually delete some
rows from the data file. However, if you’re processing more data, you
may want to truncate the data using some code. Here, we’ll approach the
removal of the post-failure behavior by finding the data that has a
local slope that is sufficiently negative. We’ll do this by finding the
secant over 5 points and checking if this value is more negative than a
certain threshold. First, let’s plot the data and color it by a logical
value indicating whether we’ll remove the point. This will help find an
appropriate threshold using iteration for how negative a slope should
cause a point to be removed.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fff_shear_offset</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">Specimen</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>Lead_Stress <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/lead-lag.html" class="external-link">lead</a></span><span class="op">(</span><span class="va">Stress</span>, <span class="fl">5</span><span class="op">)</span>,</span>
<span>         Lead_Strain <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/lead-lag.html" class="external-link">lead</a></span><span class="op">(</span><span class="va">Strain</span>, <span class="fl">5</span><span class="op">)</span>,</span>
<span>         Slope <span class="op">=</span> <span class="op">(</span><span class="va">Lead_Stress</span> <span class="op">-</span> <span class="va">Stress</span><span class="op">)</span> <span class="op">/</span> <span class="op">(</span><span class="va">Lead_Strain</span> <span class="op">-</span> <span class="va">Strain</span><span class="op">)</span>,</span>
<span>         Remove <span class="op">=</span> <span class="va">Slope</span> <span class="op">&lt;</span> <span class="op">-</span><span class="fl">1e5</span> <span class="op">|</span> <span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">Slope</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Strain</span>, y <span class="op">=</span> <span class="va">Stress</span>, shape <span class="op">=</span> <span class="va">Specimen</span>, color <span class="op">=</span> <span class="va">Remove</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="stress-strain_files/figure-html/unnamed-chunk-18-1.png" width="480"></p>
<p>The criteria above seems to cut the data off at about the correct
point, but after the initial cutoff, some subsequent data would be
incorrectly retained. In order to avoid this, we’ll add another criteria
that for each curve, as soon as a single data point is removed, all
subsequent data points will also be removed.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fff_shear_offset</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">Specimen</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>Lead_Stress <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/lead-lag.html" class="external-link">lead</a></span><span class="op">(</span><span class="va">Stress</span>, <span class="fl">5</span><span class="op">)</span>,</span>
<span>         Lead_Strain <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/lead-lag.html" class="external-link">lead</a></span><span class="op">(</span><span class="va">Strain</span>, <span class="fl">5</span><span class="op">)</span>,</span>
<span>         Slope <span class="op">=</span> <span class="op">(</span><span class="va">Lead_Stress</span> <span class="op">-</span> <span class="va">Stress</span><span class="op">)</span> <span class="op">/</span> <span class="op">(</span><span class="va">Lead_Strain</span> <span class="op">-</span> <span class="va">Strain</span><span class="op">)</span>,</span>
<span>         Remove <span class="op">=</span> <span class="va">Slope</span> <span class="op">&lt;</span> <span class="op">-</span><span class="fl">1e5</span> <span class="op">|</span> <span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">Slope</span><span class="op">)</span>,</span>
<span>         Remove <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cumsum.html" class="external-link">cumsum</a></span><span class="op">(</span><span class="va">Remove</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Strain</span>, y <span class="op">=</span> <span class="va">Stress</span>, shape <span class="op">=</span> <span class="va">Specimen</span>, color <span class="op">=</span> <span class="va">Remove</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="stress-strain_files/figure-html/unnamed-chunk-19-1.png" width="480"></p>
<p>We’ll save this result to a new variable, remove the groupings,
filter out the points that we intend to remove and drop the unneeded
temporary variables.</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fff_shear_truncated</span> <span class="op">&lt;-</span> <span class="va">fff_shear_offset</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">Specimen</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>Lead_Stress <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/lead-lag.html" class="external-link">lead</a></span><span class="op">(</span><span class="va">Stress</span>, <span class="fl">5</span><span class="op">)</span>,</span>
<span>         Lead_Strain <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/lead-lag.html" class="external-link">lead</a></span><span class="op">(</span><span class="va">Strain</span>, <span class="fl">5</span><span class="op">)</span>,</span>
<span>         Slope <span class="op">=</span> <span class="op">(</span><span class="va">Lead_Stress</span> <span class="op">-</span> <span class="va">Stress</span><span class="op">)</span> <span class="op">/</span> <span class="op">(</span><span class="va">Lead_Strain</span> <span class="op">-</span> <span class="va">Strain</span><span class="op">)</span>,</span>
<span>         Remove <span class="op">=</span> <span class="va">Slope</span> <span class="op">&lt;</span> <span class="op">-</span><span class="fl">1e5</span> <span class="op">|</span> <span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">Slope</span><span class="op">)</span>,</span>
<span>         Remove <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cumsum.html" class="external-link">cumsum</a></span><span class="op">(</span><span class="va">Remove</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">ungroup</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="op">!</span><span class="va">Remove</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">Specimen</span>, <span class="va">Stress</span>, <span class="va">Strain</span><span class="op">)</span></span></code></pre></div>
<p>Next, we’ll remove the “toe” of each curve. The “toe” extends to a
stress of somewhat less than 1000 <code>psi</code>, so we’ll remove the
“toe” by simply removing all the data with a stress less than 1000
<code>psi</code>.</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fff_shear_truncated_no_toe</span> <span class="op">&lt;-</span> <span class="va">fff_shear_truncated</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">Stress</span> <span class="op">&gt;</span> <span class="fl">1000</span><span class="op">)</span></span></code></pre></div>
<p>Now, let’s plot this pre-processed data.</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fff_shear_truncated_no_toe</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Strain</span>, y <span class="op">=</span> <span class="va">Stress</span>, color <span class="op">=</span> <span class="va">Specimen</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/lims.html" class="external-link">xlim</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="cn">NA</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/lims.html" class="external-link">ylim</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="cn">NA</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="stress-strain_files/figure-html/unnamed-chunk-22-1.png" width="480"></p>
<p>Now, let’s try fitting an averaged curve to this data.</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">curve_fff_shear</span> <span class="op">&lt;-</span> <span class="va">fff_shear_truncated_no_toe</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/average_curve_lm.html">average_curve_lm</a></span><span class="op">(</span></span>
<span>    <span class="va">Specimen</span>,</span>
<span>    <span class="va">Stress</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/AsIs.html" class="external-link">I</a></span><span class="op">(</span><span class="va">Strain</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/AsIs.html" class="external-link">I</a></span><span class="op">(</span><span class="va">Strain</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/AsIs.html" class="external-link">I</a></span><span class="op">(</span><span class="va">Strain</span><span class="op">^</span><span class="fl">3</span><span class="op">)</span> <span class="op">+</span> <span class="fl">0</span></span>
<span>  <span class="op">)</span></span>
<span><span class="va">curve_fff_shear</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Range: ` Strain ` in  [ 0,  0.112092 ]</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Call:</span></span>
<span><span class="co">#&gt; average_curve_lm(data = ., coupon_var = Specimen, model = Stress ~ </span></span>
<span><span class="co">#&gt;     I(Strain) + I(Strain^2) + I(Strain^3) + 0)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Coefficients:</span></span>
<span><span class="co">#&gt;   I(Strain)  I(Strain^2)  I(Strain^3)  </span></span>
<span><span class="co">#&gt;      129670      -312398     -2060929</span></span></code></pre></div>
<p>And we’ll plot this curve fit overlaid on the data with only the
strain offset corrected (leaving the “toe” and the post-failure behavior
intact).</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">curve_fff_shear</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://generics.r-lib.org/reference/augment.html" class="external-link">augment</a></span><span class="op">(</span><span class="va">fff_shear</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Strain</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">Stress</span>, color <span class="op">=</span> <span class="va">Specimen</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">.fit</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="stress-strain_files/figure-html/unnamed-chunk-24-1.png" width="480"></p>
</div>
<div class="section level2">
<h2 id="plots-for-publication">Plots for Publication<a class="anchor" aria-label="anchor" href="#plots-for-publication"></a>
</h2>
<p>The last part of this vignette will focus on creating plots for
publication in reports. We’ll focus on the following items as examples.
It will be up to you how you want to customize your plots for your
particular publication.</p>
<ul>
<li>Changing the theme</li>
<li>Overlaying curves and data from multiple environmental
conditions</li>
<li>Adding a secondary y-axis to show both US Customary and SI
units</li>
</ul>
<p>The <code>cmstatrExt</code> package does not come with any data sets
with multiple environmental conditions. We’ll “fake it” for illustration
purposes by scaling the <code>pa12_tension</code> stress by 50% and
strain by 125% to generate data for the “Fake ETA” environmental
condition. We’ll create a new data frame by stacking the original
<code>pa12_tension</code> data frame and a version of the
<code>pa12_tension</code> data frame with the stress scaled. Before
stacking these data frames, we’ll add a new column for condition.</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pa12_tension_conditions</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">bind_rows</a></span><span class="op">(</span></span>
<span>    <span class="va">pa12_tension</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>      <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>Condition <span class="op">=</span> <span class="st">"RTA"</span><span class="op">)</span>,</span>
<span>    <span class="va">pa12_tension</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>      <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>Condition <span class="op">=</span> <span class="st">"Fake ETA"</span>,</span>
<span>             Stress <span class="op">=</span> <span class="fl">0.50</span> <span class="op">*</span> <span class="va">Stress</span>,</span>
<span>             Strain <span class="op">=</span> <span class="fl">1.25</span> <span class="op">*</span> <span class="va">Strain</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p>We already have a cubic model for the original
<code>pa12_tension</code> data, but that model was missing the
<code>Condition</code> column, so we’ll fit it again.</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">curve_cubic_rta</span> <span class="op">&lt;-</span> <span class="va">pa12_tension_conditions</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">Condition</span> <span class="op">==</span> <span class="st">"RTA"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/average_curve_lm.html">average_curve_lm</a></span><span class="op">(</span></span>
<span>    <span class="va">Coupon</span>,</span>
<span>    <span class="va">Stress</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/AsIs.html" class="external-link">I</a></span><span class="op">(</span><span class="va">Strain</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/AsIs.html" class="external-link">I</a></span><span class="op">(</span><span class="va">Strain</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/AsIs.html" class="external-link">I</a></span><span class="op">(</span><span class="va">Strain</span><span class="op">^</span><span class="fl">3</span><span class="op">)</span> <span class="op">+</span> <span class="fl">0</span></span>
<span>  <span class="op">)</span></span>
<span><span class="va">curve_cubic_rta</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Range: ` Strain ` in  [ 0,  0.1409409 ]</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Call:</span></span>
<span><span class="co">#&gt; average_curve_lm(data = ., coupon_var = Coupon, model = Stress ~ </span></span>
<span><span class="co">#&gt;     I(Strain) + I(Strain^2) + I(Strain^3) + 0)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Coefficients:</span></span>
<span><span class="co">#&gt;   I(Strain)  I(Strain^2)  I(Strain^3)  </span></span>
<span><span class="co">#&gt;        1173        -8762        20481</span></span></code></pre></div>
<p>We’ll do the same for the “Fake ETA” data.</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">curve_cubic_fake_eta</span> <span class="op">&lt;-</span> <span class="va">pa12_tension_conditions</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">Condition</span> <span class="op">==</span> <span class="st">"Fake ETA"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/average_curve_lm.html">average_curve_lm</a></span><span class="op">(</span></span>
<span>    <span class="va">Coupon</span>,</span>
<span>    <span class="va">Stress</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/AsIs.html" class="external-link">I</a></span><span class="op">(</span><span class="va">Strain</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/AsIs.html" class="external-link">I</a></span><span class="op">(</span><span class="va">Strain</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/AsIs.html" class="external-link">I</a></span><span class="op">(</span><span class="va">Strain</span><span class="op">^</span><span class="fl">3</span><span class="op">)</span> <span class="op">+</span> <span class="fl">0</span></span>
<span>  <span class="op">)</span></span>
<span><span class="va">curve_cubic_fake_eta</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Range: ` Strain ` in  [ 0,  0.1761762 ]</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Call:</span></span>
<span><span class="co">#&gt; average_curve_lm(data = ., coupon_var = Coupon, model = Stress ~ </span></span>
<span><span class="co">#&gt;     I(Strain) + I(Strain^2) + I(Strain^3) + 0)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Coefficients:</span></span>
<span><span class="co">#&gt;   I(Strain)  I(Strain^2)  I(Strain^3)  </span></span>
<span><span class="co">#&gt;       469.3      -2803.8       5243.1</span></span></code></pre></div>
<p>Now, we can plot the two curves.</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">bind_rows</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://generics.r-lib.org/reference/augment.html" class="external-link">augment</a></span><span class="op">(</span><span class="va">curve_cubic_rta</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://generics.r-lib.org/reference/augment.html" class="external-link">augment</a></span><span class="op">(</span><span class="va">curve_cubic_fake_eta</span><span class="op">)</span></span>
<span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Strain</span>, y <span class="op">=</span> <span class="va">.fit</span>, color <span class="op">=</span> <span class="va">Condition</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="stress-strain_files/figure-html/unnamed-chunk-28-1.png" width="480"></p>
<p>In some cases, you’d also want to show the raw data, which can be
done as follows. Note that we needed to set the <code>group</code>
aestetic in the call to <code><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line()</a></code>.</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">bind_rows</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://generics.r-lib.org/reference/augment.html" class="external-link">augment</a></span><span class="op">(</span><span class="va">curve_cubic_rta</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://generics.r-lib.org/reference/augment.html" class="external-link">augment</a></span><span class="op">(</span><span class="va">curve_cubic_fake_eta</span><span class="op">)</span></span>
<span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">Condition</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Strain</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">Stress</span>, color <span class="op">=</span> <span class="va">Condition</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">.fit</span>, group <span class="op">=</span> <span class="va">Condition</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="stress-strain_files/figure-html/unnamed-chunk-29-1.png" width="480"></p>
<p>Next, we’ll add a secondary y-axis. Since the primary y-axis is in
units of <code>MPa</code>, the secondary y-axis will be in units of
<code>ksi</code>. To do this, we’ll use a call to
<code><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_continuous()</a></code></p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">bind_rows</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://generics.r-lib.org/reference/augment.html" class="external-link">augment</a></span><span class="op">(</span><span class="va">curve_cubic_rta</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://generics.r-lib.org/reference/augment.html" class="external-link">augment</a></span><span class="op">(</span><span class="va">curve_cubic_fake_eta</span><span class="op">)</span></span>
<span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Strain</span>, y <span class="op">=</span> <span class="va">.fit</span>, color <span class="op">=</span> <span class="va">Condition</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_continuous</a></span><span class="op">(</span></span>
<span>    <span class="st">"Stress [MPa]"</span>,</span>
<span>    sec.axis <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/sec_axis.html" class="external-link">sec_axis</a></span><span class="op">(</span><span class="op">~</span> <span class="va">.</span> <span class="op">*</span> <span class="fl">0.1450377377</span>, name <span class="op">=</span> <span class="st">"Stress [ksi]"</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p><img src="stress-strain_files/figure-html/unnamed-chunk-30-1.png" width="480"></p>
<p>And it’s likely that you’d want to change the theme of the plot
using, for example, <code><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw()</a></code> or your own custom
theme.</p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">bind_rows</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://generics.r-lib.org/reference/augment.html" class="external-link">augment</a></span><span class="op">(</span><span class="va">curve_cubic_rta</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://generics.r-lib.org/reference/augment.html" class="external-link">augment</a></span><span class="op">(</span><span class="va">curve_cubic_fake_eta</span><span class="op">)</span></span>
<span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Strain</span>, y <span class="op">=</span> <span class="va">.fit</span>, color <span class="op">=</span> <span class="va">Condition</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_continuous</a></span><span class="op">(</span></span>
<span>    <span class="st">"Stress [MPa]"</span>,</span>
<span>    sec.axis <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/sec_axis.html" class="external-link">sec_axis</a></span><span class="op">(</span><span class="op">~</span> <span class="va">.</span> <span class="op">*</span> <span class="fl">0.1450377377</span>, name <span class="op">=</span> <span class="st">"Stress [ksi]"</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="stress-strain_files/figure-html/unnamed-chunk-31-1.png" width="480"></p>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by <a href="https://www.kloppenborg.ca" class="external-link">Stefan Kloppenborg</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
