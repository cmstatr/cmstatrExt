library(tidyverse)

# nolint start
# Data digitized from the following figure:
# https://www.researchgate.net/figure/a-A-tensile-sample-ASTM-D638-b-engineering-stress-strain-curves-of-four-tensile_fig4_331599125
# nolint end
#
# The figure is from:
# Alomarah, Amer & Ruan, Dong & Masood, S. & Gao, Zhanyuan. (2019).
# Compressive properties of a novel additively manufactured 3D auxetic
# structure. Smart Materials and Structures. 28. 10.1088/1361-665X/ab0dd6.
#

dat_digitized <- tribble(
  ~Coupon, ~Strain, ~Stress,
  "Coupon 1", 0.003237410071942,	0,
  "Coupon 1", 0.006115107913669,	1.33744855967078,
  "Coupon 1", 0.010071942446043,	3.60082304526749,
  "Coupon 1", 0.014028776978417,	6.27572016460906,
  "Coupon 1", 0.01726618705036,   8.95061728395062,
  "Coupon 1", 0.021223021582734,	12.4485596707819,
  "Coupon 1", 0.027338129496403,	18.0041152263374,
  "Coupon 1", 0.030575539568345,	21.5020576131687,
  "Coupon 1", 0.040287769784173,	29.4238683127572,
  "Coupon 1", 0.047482014388489,	34.4650205761317,
  "Coupon 1", 0.056474820143885,	39.6090534979424,
  "Coupon 1", 0.065467625899281,	43.2098765432099,
  "Coupon 1", 0.076978417266187,	46.2962962962963,
  "Coupon 1", 0.085611510791367,	47.9423868312757,
  "Coupon 1", 0.096762589928058,	49.2798353909465,
  "Coupon 1", 0.109352517985611,	50.1028806584362,
  "Coupon 1", 0.121942446043165,	50.1028806584362,
  "Coupon 1", 0.134532374100719,	49.7942386831276,
  "Coupon 1", 0.143165467625899,	49.4855967078189,
  "Coupon 1", 0.148920863309353,	48.8683127572016,
  "Coupon 2", 0.001079136690647,	0,
  "Coupon 2", 0.004676258992806,	0.92592592592593,
  "Coupon 2", 0.007553956834532,	2.05761316872429,
  "Coupon 2", 0.011510791366907,	4.52674897119341,
  "Coupon 2", 0.016546762589928,	8.53909465020577,
  "Coupon 2", 0.021942446043166,	13.0658436213992,
  "Coupon 2", 0.02841726618705,    19.444444444444,
  "Coupon 2", 0.034892086330935,	25.9259259259259,
  "Coupon 2", 0.045323741007194,	33.4362139917695,
  "Coupon 2", 0.055395683453237,	38.9917695473251,
  "Coupon 2", 0.064388489208633,	42.4897119341564,
  "Coupon 2", 0.074820143884892,	45.3703703703704,
  "Coupon 2", 0.084892086330935,	47.6337448559671,
  "Coupon 2", 0.09568345323741,    48.868312757202,
  "Coupon 2", 0.106834532374101,	49.5884773662552,
  "Coupon 2", 0.117625899280576,	49.8971193415638,
  "Coupon 2", 0.128057553956835,	50,
  "Coupon 2", 0.137410071942446,	49.7942386831276,
  "Coupon 2", 0.147841726618705,	49.2798353909465,
  "Coupon 2", 0.154676258992806,	48.6625514403292,
  "Coupon 3", 0.001438848920863,	0,
  "Coupon 3", 0.006115107913669,	1.64609053497943,
  "Coupon 3", 0.010431654676259,	4.32098765432099,
  "Coupon 3", 0.016546762589928,	8.7448559670782,
  "Coupon 3", 0.020503597122302,	12.5514403292181,
  "Coupon 3", 0.028776978417266,	20.8847736625514,
  "Coupon 3", 0.033453237410072,	25.7201646090535,
  "Coupon 3", 0.038848920863309,	30.3497942386831,
  "Coupon 3", 0.045323741007194,	35.082304526749,
  "Coupon 3", 0.053956834532374,	39.40329218107,
  "Coupon 3", 0.062230215827338,	42.798353909465,
  "Coupon 3", 0.077338129496403,	46.8106995884774,
  "Coupon 3", 0.084892086330935,	48.4567901234568,
  "Coupon 3", 0.096402877697842,	49.5884773662552,
  "Coupon 3", 0.113309352517986,	50.1028806584362,
  "Coupon 3", 0.129856115107914,	50.1028806584362,
  "Coupon 3", 0.141726618705036,	49.6913580246914,
  "Coupon 3", 0.151798561151079,	49.0740740740741,
  "Coupon 3", 0.162589928057554,	48.1481481481482,
  "Coupon 3", 0.16978417266187,    47.119341563786,
  "Coupon 4", 0.002158273381295,	0,
  "Coupon 4", 0.006474820143885,	2.1604938271605,
  "Coupon 4", 0.011510791366907,	4.62962962962963,
  "Coupon 4", 0.016187050359712,	8.64197530864198,
  "Coupon 4", 0.019784172661871,	12.037037037037,
  "Coupon 4", 0.025179856115108,	16.5637860082305,
  "Coupon 4", 0.029496402877698,	20.8847736625514,
  "Coupon 4", 0.034172661870504,	25,
  "Coupon 4", 0.041726618705036,	30.9670781893004,
  "Coupon 4", 0.050719424460432,	36.2139917695473,
  "Coupon 4", 0.058992805755396,	40.1234567901235,
  "Coupon 4", 0.069064748201439,	43.6213991769547,
  "Coupon 4", 0.077338129496403,	46.1934156378601,
  "Coupon 4", 0.093165467625899,	49.0740740740741,
  "Coupon 4", 0.105755395683453,	50,
  "Coupon 4", 0.118705035971223,	50.1028806584362,
  "Coupon 4", 0.128776978417266,	49.7942386831276,
  "Coupon 4", 0.140647482014388,	48.9711934156379,
  "Coupon 4", 0.149280575539568,	47.5308641975309,
  "Coupon 4", 0.157194244604317,	45.679012345679,
  "Coupon 4", 0.164748201438849,	44.1358024691358,
  "Coupon 4", 0.170503597122302,	43.6213991769547,
  "Coupon 4", 0.177697841726619,	42.5925925925926
)

dat_digitized_corrected <- dat_digitized %>%
  filter(Strain > 0.015 & Strain < 0.040) %>%
  group_by(Coupon) %>%
  nest() %>%
  mutate(lm = map(data, ~lm(Strain ~ Stress, data = .))) %>%
  mutate(Strain = map(lm, ~predict(.x, data.frame(Stress = 0)))) %>%
  select(-c(lm, data)) %>%
  unnest(Strain) %>%
  mutate(Stress = 0) %>%
  bind_rows(
    dat_digitized %>%
      filter(Strain > 0.015)
  ) %>%
  group_by(Coupon) %>%
  arrange(Strain) %>%
  mutate(Strain = Strain - min(Strain))

dat_digitized_corrected %>%
  ggplot(aes(x = Strain, y = Stress, color = Coupon)) +
  geom_point()



pa12_tension <- dat_digitized_corrected %>%
  group_by(Coupon) %>%
  nest() %>%
  mutate(data = map(data, function(df) {
    strain <- seq(0, 0.2, length.out = 1000)
    data.frame(
      approx(df$Strain, df$Stress, strain)
    ) %>%
      rename(Stress = y, Strain = x)
  })) %>%
  unnest(cols = c(data)) %>%
  filter(!is.na(Stress) & !is.na(Strain)) %>%
  mutate(Stress = rnorm(n(), Stress, 0.15)) %>%
  ungroup()

pa12_tension %>%
  ggplot(aes(x = Strain, y = Stress, color = Coupon)) +
  geom_point()

usethis::use_data(pa12_tension, overwrite = TRUE)
